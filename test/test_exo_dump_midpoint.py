
from unittest import TestCase 
from exolib import EXO, ObjectNode, TextParamNode, ShapeParamNode, StandardDrawingParamNode, PositionRange, InsertionMode, FloatTrackBarRanges
from exofile import TrackBarType, TextAlignment

class TestEXODumpMidPoint (TestCase):

  def test_dump_midpoint (self):

    DESIRABLE_DUMP = """[exedit]
width=1280
height=720
rate=24
scale=1
length=48
audio_rate=44100
audio_ch=2
[0]
start=1
end=24
layer=1
overlay=1
camera=0
[0.0]
_name=図形
サイズ=100
縦横比=0.0
ライン幅=4000
type=1
color=ffffff
name=
[0.1]
_name=標準描画
X=-100.0,100.0,1
Y=0.0,0.0,1
Z=0.0,0.0,1
拡大率=100.0
透明度=0.0
回転=0.0
blend=0
[1]
start=25
end=48
layer=1
overlay=1
camera=0
chain=1
[1.0]
_name=図形
サイズ=100
縦横比=0.0
ライン幅=4000
[1.1]
_name=標準描画
X=100.0,-100.0,1
Y=0.0,0.0,1
Z=0.0,0.0,1
拡大率=100.0
透明度=0.0
回転=0.0
"""

    exo = EXO()
    objnode = ObjectNode()
    objnode.add_objparam(ShapeParamNode(1))
    objnode.add_objparam(StandardDrawingParamNode(
      FloatTrackBarRanges((-100.0, 100.0, -100.0), TrackBarType.LINEAR),
      FloatTrackBarRanges((0.0, 0.0, 0.0), TrackBarType.LINEAR),
      FloatTrackBarRanges((0.0, 0.0, 0.0), TrackBarType.LINEAR)
    ))
    objnode.add_midpoint(24)
    exo.insert_object(1, PositionRange(1, 48), objnode)
    exo.fit_length_to_last_object()
    self.assertEqual(set(exo.dumps().strip().split("\n")), set(DESIRABLE_DUMP.strip().split("\n") + [ "audio=0" ])) #ObjectNodeはaudio=0を自動的に付与するため、比較対象にも付与します。

  def test_dump_midpoint2 (self):

    DESIRABLE_DUMP = """[exedit]
width=1280
height=720
rate=24
scale=1
length=48
audio_rate=44100
audio_ch=2
[0]
layer=1
start=1
end=24
overlay=1
camera=0
audio=0
[0.0]
_name=テキスト
text=3e54298f6f302b73673042308b30023000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
autoadjust=0
soft=1
monospace=0
align=4
type=0
precision=1
color=ffffff
color2=000000
font=MS UI Gothic
サイズ=34
表示速度=0.0
文字毎に個別オブジェクト=0
移動座標上に表示する=0
自動スクロール=0
B=0
I=0
spacing_x=0
spacing_y=0
[0.1]
_name=標準描画
blend=0
X=-100.0,100.0,1
Y=0.0,0.0,1
Z=0.0,0.0,1
拡大率=100.0
透明度=0.0
回転=0.0
[1]
chain=1
layer=1
start=25
end=48
overlay=1
camera=0
audio=0
[1.0]
_name=テキスト
text=3e54298f6f302b73673042308b30023000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
autoadjust=0
soft=1
monospace=0
align=4
type=0
precision=1
color=ffffff
color2=000000
font=MS UI Gothic
サイズ=34
表示速度=0.0
文字毎に個別オブジェクト=0
移動座標上に表示する=0
自動スクロール=0
B=0
I=0
spacing_x=0
spacing_y=0
[1.1]
_name=標準描画
blend=0
X=100.0,-100.0,1
Y=0.0,0.0,1
Z=0.0,0.0,1
拡大率=100.0
透明度=0.0
回転=0.0
"""

    exo = EXO()
    textobj = ObjectNode()
    textobj.add_objparam(TextParamNode("吾輩は猫である。", align=TextAlignment.ALIGN_CENTER_MIDDLE)) 
    textobj.add_objparam(StandardDrawingParamNode(
      FloatTrackBarRanges((-100, 100, -100), TrackBarType.LINEAR), 
      FloatTrackBarRanges((0, 0, 0), TrackBarType.LINEAR), 
      FloatTrackBarRanges((0, 0, 0), TrackBarType.LINEAR)
    ))
    textobj.add_midpoint(24)
    exo.insert_object(1, PositionRange(1, 48), textobj, InsertionMode.SHIFT_RIGHT) #layer1, 1 ~ 24
    exo.fit_length_to_last_object()
    self.assertEqual(set(exo.dumps().strip().split("\n")), set(DESIRABLE_DUMP.strip().split("\n") + [ "audio=0" ])) #ObjectNodeはaudio=0を自動的に付与するため、比較対象にも付与します。
